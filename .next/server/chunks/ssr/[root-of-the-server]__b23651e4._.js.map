{"version":3,"sources":["turbopack:///[project]/src/server/services/locations-service.ts"],"sourcesContent":["import z from \"zod\"\r\nimport { prisma } from \"@/server/prisma-client\"\r\nimport type { Location, Prisma, PrismaPromise } from \"@prisma/client\"\r\nimport { LocationWithNews } from \"@/types/dto/location-with-news\"\r\nimport { Pagination } from \"@/types/dto/pagination\"\r\n\r\nconst createLocationSchema = z.object({\r\n  title: z.string().min(1, \"Название обязательно\"),\r\n  image: z.string().optional(),\r\n})\r\n\r\nexport type CreateLocationRequestBody = z.infer<typeof createLocationSchema>\r\n\r\nexport const createLocation = async (body: CreateLocationRequestBody) => {\r\n  createLocationSchema.parse(body)\r\n\r\n  return prisma.location.create({\r\n    data: body,\r\n  })\r\n}\r\n\r\nexport type GetLocationsQueryParams = {\r\n  offset?: number\r\n  limit?: number\r\n  search?: string\r\n}\r\n\r\ntype GetLocations = (\r\n  queryParams: GetLocationsQueryParams,\r\n) => Promise<Pagination<Location[]>>\r\n\r\nexport const geLocationsQueryOptions = (\r\n  queryParams: GetLocationsQueryParams,\r\n): Prisma.LocationFindManyArgs => ({\r\n  where: {\r\n    title: {\r\n      contains: queryParams.search,\r\n    },\r\n  },\r\n  take: queryParams.limit || 10,\r\n  skip: queryParams.offset || 0,\r\n  orderBy: {\r\n    createdAt: \"asc\",\r\n  },\r\n})\r\n\r\nexport const getLocations: GetLocations = async (queryParams) => ({\r\n  data: await prisma.location.findMany(geLocationsQueryOptions(queryParams)),\r\n  limit: queryParams.limit || 10,\r\n  offset: queryParams.offset || 0,\r\n  total: await prisma.location.count({\r\n    where: {\r\n      title: {\r\n        contains: queryParams.search,\r\n      },\r\n    },\r\n  }),\r\n})\r\n\r\nconst updateLocationSchema = createLocationSchema.partial()\r\n\r\nexport type UpdateLocationRequestBody = z.infer<typeof updateLocationSchema>\r\n\r\nexport const updateLocation = async (\r\n  uuid: string,\r\n  body: UpdateLocationRequestBody,\r\n) => {\r\n  updateLocationSchema.parse(body)\r\n\r\n  return prisma.location.update({\r\n    where: { uuid },\r\n    data: body,\r\n  })\r\n}\r\n\r\nexport const deleteLocation = async (uuid: string) => {\r\n  return prisma.location.delete({\r\n    where: { uuid },\r\n  })\r\n}\r\n\r\nconst addEditorToLocationSchema = z.object({\r\n  editorUuid: z.string().min(1, \"Uuid редактора обязательно\"),\r\n})\r\n\r\nexport type AddEditorToLocationRequestBody = z.infer<\r\n  typeof addEditorToLocationSchema\r\n>\r\n\r\nexport const addEditorToLocation = async (\r\n  uuid: string,\r\n  body: AddEditorToLocationRequestBody,\r\n) => {\r\n  addEditorToLocationSchema.parse(body)\r\n\r\n  return prisma.location.update({\r\n    where: { uuid },\r\n    data: { editors: { connect: { uuid: body.editorUuid } } },\r\n  })\r\n}\r\n\r\nexport const getLocation = async (uuid: string): Promise<Location | null> =>\r\n  prisma.location.findFirst({\r\n    where: { uuid },\r\n  })\r\n\r\nexport const getLocationsWithNews = (): PrismaPromise<LocationWithNews[]> =>\r\n  prisma.location.findMany({\r\n    include: {\r\n      news: {\r\n        take: 4,\r\n        omit: {\r\n          userUuid: true,\r\n          locationUuid: true,\r\n        },\r\n      },\r\n    },\r\n  })\r\n"],"names":[],"mappings":"skBAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,QAKA,IAAM,EAAuB,EAAA,OAAC,CAAC,MAAM,CAAC,CACpC,MAAO,EAAA,OAAC,CAAC,MAAM,GAAG,GAAG,CAAC,EAAG,wBACzB,MAAO,EAAA,OAAC,CAAC,MAAM,GAAG,QAAQ,EAC5B,GAqCa,EAA6B,MAAO,IAAiB,CAChE,KAAM,IADyD,EACnD,EAAA,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAhBA,AACrC,IACiC,CACjC,MAAO,CACL,EAF8B,IAEvB,CACL,SAAU,EAAY,MAAM,AAC9B,CACF,EACA,KAAM,EAAY,KAAK,EAAI,GAC3B,KAAM,EAAY,MAAM,EAAI,EAC5B,QAAS,CACP,UAAW,KACb,CACF,EAAC,EAG8D,IAC7D,MAAO,EAAY,KAAK,EAAI,GAC5B,OAAQ,EAAY,MAAM,EAAI,EAC9B,MAAO,MAAM,EAAA,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CACjC,MAAO,CACL,MAAO,CACL,SAAU,EAAY,MAAM,AAC9B,CACF,CACF,GACF,CAAC,CAE4B,EAAqB,OAAO,GAsBvB,EAAA,OAAC,CAAC,MAAM,CAAC,CACzC,WAAY,EAAA,OAAC,CAAC,MAAM,GAAG,GAAG,CAAC,EAAG,6BAChC,GAkBO,IAAM,EAAc,MAAO,GAChC,EAAA,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,CACxB,MAAO,CAAE,MAAK,CAChB,GAEW,EAAuB,IAClC,EAAA,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CACvB,QAAS,CACP,KAAM,CACJ,KAAM,EACN,KAAM,CACJ,UAAU,EACV,cAAc,CAChB,CACF,CACF,CACF"}