module.exports=[500874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},224361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},688947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},275343,(e,t,r)=>{t.exports=e.x("bcrypt",()=>require("bcrypt"))},851622,e=>{"use strict";e.s(["deleteJwtCookie",()=>i,"generateJwtCookie",()=>s,"generateJwtToken",()=>a]);var t=e.i(724652),r=e.i(904739);let a=e=>t.default.sign(e,process.env.JWT_SECRET),s=e=>(0,r.serialize)("jwt",a(e),{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:604800}),i=()=>(0,r.serialize)("jwt","",{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:0})},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},120635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},876096,(e,t,r)=>{t.exports=e.x("@prisma/client/scripts/default-index.js",()=>require("@prisma/client/scripts/default-index.js"))},270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},961724,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js"))},383097,e=>{"use strict";e.s(["ApiError",()=>t,"getApiError",()=>r]);class t extends Error{status;data;constructor(e){super(e.message||"An error occurred"),this.status=e.status,this.data=e.data??void 0}}let r=e=>{if("object"==typeof e&&null!==e&&"status"in e&&"message"in e)return new t({status:Number(e.status)||500,message:e.message,data:e.data});let r=e=>new t({status:500,message:e,data:void 0}),a=e=>"object"==typeof e&&null!==e&&"data"in e;if(!a(e))return r(e instanceof Error?e.message:"Произошла неизвестная ошибка");if(!a(e.data))return r(e.data instanceof Error?e.data.message:"Произошла неизвестная ошибка");let s=e.data;return new t({status:Number(s.status)||500,message:s.error||"Ошибка запроса",data:s.data??void 0})}},686929,e=>{"use strict";e.s(["prisma",()=>i],686929);var t=e.i(29173),r=e.i(876096),a="@prisma/extension-accelerate",s="Unable to connect to the Accelerate API. This may be due to a network or DNS issue. Please check your connection and the Accelerate connection string. For details, visit https://www.prisma.io/docs/accelerate/troubleshoot.";let i=new t.PrismaClient().$extends(function(e){var t;let i;return t=(void 0)??fetch,i=function(e,t){let[r=0,a=0,s=0]=e.split(".").map(Number),[i=0,n=0,o=0]=t.split(".").map(Number);return i-r||n-a||o-s}("5.1.0",r.default.Prisma.prismaVersion.client)>=0,r.default.Prisma.defineExtension(e=>{let n,o,l,{apiKeyPromise:u,baseURL:c}=function(e){let t=Reflect.get(e,"_accelerateEngineConfig");try{let{host:e,hostname:r,protocol:a,searchParams:s}=new URL(t?.accelerateUtils?.resolveDatasourceUrl?.(t));if("prisma+postgres:"===a&&("localhost"===r||"127.0.0.1"===r))return{apiKeyPromise:Promise.resolve(s.get("api_key")),baseURL:new URL(`http://${e}`)}}catch{}return{apiKeyPromise:e._engine.start().then(()=>e._engine.apiKey?.()??null),baseURL:new URL("https://accelerate.prisma-data.net")}}(e),d=(n=r.default.Prisma.prismaVersion,o=["u">typeof navigator?navigator.userAgent:"u">typeof process&&"u">typeof process.versions?`Node/${process.versions.node} (${process.platform}; ${process.arch})`:"EdgeRuntime"in globalThis?"Vercel-Edge-Runtime":"UnknownRuntime",`PrismaEngine/${n.engine}`,`PrismaClient/${n.client}`].join(" "),async e=>{let{args:r}=e,{cacheStrategy:a,__accelerateInfo:i=!1,...n}=r,u=null,{__internalParams:c,query:d}=e;return c.customDataProxyFetch=()=>async(e,r)=>{let i=[];"number"==typeof a?.ttl&&i.push(`max-age=${a.ttl}`),"number"==typeof a?.swr&&i.push(`stale-while-revalidate=${a.swr}`);let n=a?.tags?.join(",")??"";r.headers={...r.headers,"cache-control":i.length>0?i.join(","):"no-cache","user-agent":o,...n.length>0?{"accelerate-cache-tags":n}:{}},l&&(r.headers["accelerate-query-engine-jwt"]=l);try{let a=await t(e,r);return u={cacheStatus:a.headers.get("accelerate-cache-status"),lastModified:new Date(a.headers.get("last-modified")??""),region:a.headers.get("cf-ray")?.split("-")[1]??"unspecified",requestId:a.headers.get("cf-ray")??"unspecified",signature:a.headers.get("accelerate-signature")??"unspecified"},l=a.headers.get("accelerate-query-engine-jwt")??void 0,a}catch{throw Error(s)}},i?{data:await d(n,c),info:u}:d(n,c)});async function p(e){let r,a=await u;if(!a)return{requestId:"unspecified"};try{r=await t(new URL("/invalidate",c).href,{method:"POST",headers:{authorization:`Bearer ${a}`,"content-type":"application/json"},body:JSON.stringify(e)})}catch{throw Error(s)}if(!r?.ok){let e=await r.text();throw Error(`Failed to invalidate Accelerate cache. Response was ${r.status} ${r.statusText}. ${e}`)}return r.body?.cancel(),{requestId:r.headers.get("cf-ray")??"unspecified"}}let m=e.$extends({name:a,query:{$allModels:{$allOperations:d}}});return m.$extends({name:a,client:{$accelerate:{invalidate:e=>p(e),invalidateAll:()=>p({tags:"all"})}},model:{$allModels:{aggregate(e){let t=r.default.Prisma.getExtensionContext(this),a=i?t.$parent[t.$name]:m[t.name];return Object.assign(a.aggregate(e),{withAccelerateInfo:()=>a.aggregate({...e,__accelerateInfo:!0})})},count(e){let t=r.default.Prisma.getExtensionContext(this),a=i?t.$parent[t.$name]:m[t.name];return Object.assign(a.count(e),{withAccelerateInfo:()=>a.count({...e,__accelerateInfo:!0})})},findFirst(e){let t=r.default.Prisma.getExtensionContext(this),a=i?t.$parent[t.$name]:m[t.name];return Object.assign(a.findFirst(e),{withAccelerateInfo:()=>a.findFirst({...e,__accelerateInfo:!0})})},findFirstOrThrow(e){let t=r.default.Prisma.getExtensionContext(this),a=i?t.$parent[t.$name]:m[t.name];return Object.assign(a.findFirstOrThrow(e),{withAccelerateInfo:()=>a.findFirstOrThrow({...e,__accelerateInfo:!0})})},findMany(e){let t=r.default.Prisma.getExtensionContext(this),a=i?t.$parent[t.$name]:m[t.name];return Object.assign(a.findMany(e),{withAccelerateInfo:()=>a.findMany({...e,__accelerateInfo:!0})})},findUnique(e){let t=r.default.Prisma.getExtensionContext(this),a=i?t.$parent[t.$name]:m[t.name];return Object.assign(a.findUnique(e),{withAccelerateInfo:()=>a.findUnique({...e,__accelerateInfo:!0})})},findUniqueOrThrow(e){let t=r.default.Prisma.getExtensionContext(this),a=i?t.$parent[t.$name]:m[t.name];return Object.assign(a.findUniqueOrThrow(e),{withAccelerateInfo:()=>a.findUniqueOrThrow({...e,__accelerateInfo:!0})})},groupBy(e){let t=r.default.Prisma.getExtensionContext(this),a=i?t.$parent[t.$name]:m[t.name];return Object.assign(a.groupBy(e),{withAccelerateInfo:()=>a.groupBy({...e,__accelerateInfo:!0})})}}}})})}())},63059,e=>{"use strict";e.s(["handleResponse",()=>r]);var t=e.i(89171);let r=(e,r,a,s)=>t.NextResponse.json({status:r,message:e,data:a},{status:r,headers:s})},282623,e=>{"use strict";e.s(["handleError",()=>a]);var t=e.i(383097),r=e.i(63059);let a=e=>{if(e instanceof t.ApiError)return(0,r.handleResponse)(e.message,e.status,e.data);if(e&&"object"==typeof e&&"issues"in e&&Array.isArray(e.issues)){let t=e.issues.map(e=>e.message);return(0,r.handleResponse)(t.join("; "),400)}let a=(0,t.getApiError)(e);return(0,r.handleResponse)(a.message,a.status,a.data)}},501424,e=>{"use strict";e.s(["auth",()=>n,"createRoute",()=>a,"errorBoundary",()=>s,"jsonBody",()=>i,"requireRole",()=>o]);var t=e.i(282623),r=e.i(686929);let a=(e,t)=>{let r=e.reduceRight((e,t)=>t(e),t);return async(e,t)=>{let a=t?.params,s=a&&"function"==typeof a.then?await a:a,i=Object.fromEntries(new URL(e.url).searchParams.entries());return r({request:e,params:s,queryParams:i})}},s=()=>e=>async r=>{try{return await e(r)}catch(e){return(0,t.handleError)(e)}};function i(){return e=>async r=>{try{let t=await r.request.json();return e({...r,body:t})}catch{return(0,t.handleError)({status:400,message:"Invalid JSON body"})}}}let n=()=>r=>async a=>{let s=a.request.headers.get("cookie")||"",{parse:i}=await e.A(696569),n=await e.A(119764),o=i(s).jwt;if(!o)return(0,t.handleError)({status:401,message:"Не авторизован"});try{let e=n.default.verify(o,process.env.JWT_SECRET);return r({...a,userUuid:e})}catch{return(0,t.handleError)({status:401,message:"Неверный токен"})}},o=e=>a=>async s=>{let i=Array.isArray(e)?e:[e],n=await r.prisma.user.findFirst({where:{uuid:s.userUuid}});return n?i.includes(n.role)?a(s):(0,t.handleError)({status:403,message:"Нет доступа"}):(0,t.handleError)({status:401,message:"Не авторизован"})}},904739,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parse=function(e,t){let r=new l,a=e.length;if(a<2)return r;let s=t?.decode||d,i=0;do{let t=e.indexOf("=",i);if(-1===t)break;let n=e.indexOf(";",i),o=-1===n?a:n;if(t>o){i=e.lastIndexOf(";",t-1)+1;continue}let l=u(e,i,t),d=c(e,t,l),p=e.slice(l,d);if(void 0===r[p]){let a=u(e,t+1,o),i=c(e,o,a),n=s(e.slice(a,i));r[p]=n}i=o+1}while(i<a)return r},r.serialize=function(e,t,r){let l=r?.encode||encodeURIComponent;if(!a.test(e))throw TypeError(`argument name is invalid: ${e}`);let u=l(t);if(!s.test(u))throw TypeError(`argument val is invalid: ${t}`);let c=e+"="+u;if(!r)return c;if(void 0!==r.maxAge){if(!Number.isInteger(r.maxAge))throw TypeError(`option maxAge is invalid: ${r.maxAge}`);c+="; Max-Age="+r.maxAge}if(r.domain){if(!i.test(r.domain))throw TypeError(`option domain is invalid: ${r.domain}`);c+="; Domain="+r.domain}if(r.path){if(!n.test(r.path))throw TypeError(`option path is invalid: ${r.path}`);c+="; Path="+r.path}if(r.expires){var d;if(d=r.expires,"[object Date]"!==o.call(d)||!Number.isFinite(r.expires.valueOf()))throw TypeError(`option expires is invalid: ${r.expires}`);c+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(c+="; HttpOnly"),r.secure&&(c+="; Secure"),r.partitioned&&(c+="; Partitioned"),r.priority)switch("string"==typeof r.priority?r.priority.toLowerCase():void 0){case"low":c+="; Priority=Low";break;case"medium":c+="; Priority=Medium";break;case"high":c+="; Priority=High";break;default:throw TypeError(`option priority is invalid: ${r.priority}`)}if(r.sameSite)switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:case"strict":c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"none":c+="; SameSite=None";break;default:throw TypeError(`option sameSite is invalid: ${r.sameSite}`)}return c};let a=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,s=/^[\u0021-\u003A\u003C-\u007E]*$/,i=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,o=Object.prototype.toString,l=(()=>{let e=function(){};return e.prototype=Object.create(null),e})();function u(e,t,r){do{let r=e.charCodeAt(t);if(32!==r&&9!==r)return t}while(++t<r)return r}function c(e,t,r){for(;t>r;){let r=e.charCodeAt(--t);if(32!==r&&9!==r)return t+1}return r}function d(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch(t){return e}}},433450,e=>{"use strict";e.s(["deleteUser",()=>x,"getMe",()=>p,"getUsers",()=>w,"googleAuth",()=>v,"signInUser",()=>d,"signUpUser",()=>u,"updateLanguage",()=>f,"updateUser",()=>h,"updateUserAdmin",()=>b],433450);var t=e.i(275343),r=e.i(29173),a=e.i(383097),s=e.i(861166),i=e.i(686929),n=e.i(89171),o=e.i(851622);let l=s.default.object({firstName:s.default.string().min(1,"Имя обязательно"),lastName:s.default.string().min(1,"Фамилия обязательна"),email:s.default.string().min(1,"Email обязателен").refine(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),{message:"Некорректный email адрес"}),password:s.default.string().min(8,"Пароль слишком короткий").max(64,"Пароль слишком длинный")}),u=async e=>{l.parse(e);let s=await t.default.hash(e.password,12);try{return i.prisma.user.create({data:{email:e.email,firstName:e.firstName,lastName:e.lastName,password:s},omit:{password:!0}})}catch(e){if(e instanceof r.Prisma.PrismaClientKnownRequestError&&"P2002"===e.code)throw new a.ApiError({status:400,message:"Пользователь с таким email уже есть"});throw new a.ApiError({status:500,message:"Неизвестная ошибка"})}},c=s.default.object({email:s.default.string().min(1,"Email обязателен").refine(e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),{message:"Некорректный email адрес"}),password:s.default.string().min(8,"Пароль слишком короткий").max(64,"Пароль слишком длинный")}),d=async e=>{let r;c.parse(e);let s=await i.prisma.user.findFirst({where:{email:e.email}});if(!s||!await t.default.compare(e.password,s.password))throw new a.ApiError({status:400,message:"Неверный email или пароль"});return r=["password"],Object.fromEntries(Object.entries(s).filter(([e])=>!r.includes(e)))},p=async e=>{let t=await i.prisma.user.findFirst({where:{uuid:e},omit:{password:!0}});if(!t)throw new a.ApiError({status:401,message:"Не авторизован"});return t},m=s.default.object({language:s.default.enum(r.Language)}),f=async(e,t)=>(m.parse(e),await i.prisma.user.update({where:{uuid:t},data:{language:e.language},omit:{password:!0}})),g=s.default.object({firstName:s.default.string(),lastName:s.default.string()}),h=async(e,t)=>(g.parse(t),i.prisma.user.update({where:{uuid:e},data:{...t}})),w=async e=>{let t=e.search||"";return{data:await i.prisma.user.findMany((e=>{let t=e.search||"";return{where:{OR:[{email:{contains:t}},{firstName:{contains:t}},{lastName:{contains:t}}]},take:e.limit||10,skip:e.offset||0,orderBy:{createdAt:"asc"}}})(e)),limit:e.limit||10,offset:e.offset||0,total:await i.prisma.user.count({where:{OR:[{email:{contains:t}},{firstName:{contains:t}},{lastName:{contains:t}}]}})}},x=e=>i.prisma.user.delete({where:{uuid:e}}),y=s.default.object({firstName:s.default.string(),lastName:s.default.string(),email:s.default.string(),role:s.default.enum(r.UserRole),language:s.default.enum(r.Language),locationUuid:s.default.string()}),b=async(e,t)=>(y.parse(t),i.prisma.user.update({where:{uuid:e},data:{...t}})),v=async(e,t)=>{let r,a=process.env.GOOGLE_CLIENT_ID,s=process.env.GOOGLE_CLIENT_SECRET,l=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({code:e,client_id:a,client_secret:s,redirect_uri:"https://soyuzvestey.by/api/user/google/callback",grant_type:"authorization_code"})}),c=await l.json();console.log("response",c),c.access_token||console.error("Token exchange failed",c);let d=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${c.access_token}`}}),p=await d.json();console.log("userdata",p);let m={firstName:p.given_name,lastName:p.family_name,email:p.email,password:"google_oauth2_password"};try{r=await i.prisma.user.findFirst({where:{email:p.email}})}catch{r=null}if(console.log("existingUser",r),console.log("url",new URL("/",t)),r){let e=n.NextResponse.redirect(new URL("/","https://soyuzvestey.by"));return e.cookies.set("jwt",(0,o.generateJwtToken)(r.uuid),{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),e}let f=await u(m),g=n.NextResponse.redirect(new URL("/","https://soyuzvestey.by"));return g.cookies.set("jwt",(0,o.generateJwtToken)(f.uuid),{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800,path:"/"}),g}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__55cc2f9d._.js.map