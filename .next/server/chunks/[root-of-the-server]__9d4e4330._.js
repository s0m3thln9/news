module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},120635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},876096,(e,t,r)=>{t.exports=e.x("@prisma/client/scripts/default-index.js",()=>require("@prisma/client/scripts/default-index.js"))},270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},961724,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-route-turbo.runtime.prod.js"))},383097,e=>{"use strict";e.s(["ApiError",()=>t,"getApiError",()=>r]);class t extends Error{status;data;constructor(e){super(e.message||"An error occurred"),this.status=e.status,this.data=e.data??void 0}}let r=e=>{if("object"==typeof e&&null!==e&&"status"in e&&"message"in e)return new t({status:Number(e.status)||500,message:e.message,data:e.data});let r=e=>new t({status:500,message:e,data:void 0}),a=e=>"object"==typeof e&&null!==e&&"data"in e;if(!a(e))return r(e instanceof Error?e.message:"Произошла неизвестная ошибка");if(!a(e.data))return r(e.data instanceof Error?e.data.message:"Произошла неизвестная ошибка");let n=e.data;return new t({status:Number(n.status)||500,message:n.error||"Ошибка запроса",data:n.data??void 0})}},63059,e=>{"use strict";e.s(["handleResponse",()=>r]);var t=e.i(89171);let r=(e,r,a,n)=>t.NextResponse.json({status:r,message:e,data:a},{status:r,headers:n})},282623,e=>{"use strict";e.s(["handleError",()=>a]);var t=e.i(383097),r=e.i(63059);let a=e=>{if(e instanceof t.ApiError)return(0,r.handleResponse)(e.message,e.status,e.data);if(e&&"object"==typeof e&&"issues"in e&&Array.isArray(e.issues)){let t=e.issues.map(e=>e.message);return(0,r.handleResponse)(t.join("; "),400)}let a=(0,t.getApiError)(e);return(0,r.handleResponse)(a.message,a.status,a.data)}},686929,e=>{"use strict";e.s(["prisma",()=>s],686929);var t=e.i(29173),r=e.i(876096),a="@prisma/extension-accelerate",n="Unable to connect to the Accelerate API. This may be due to a network or DNS issue. Please check your connection and the Accelerate connection string. For details, visit https://www.prisma.io/docs/accelerate/troubleshoot.";let s=new t.PrismaClient().$extends(function(e){var t;let s;return t=(void 0)??fetch,s=function(e,t){let[r=0,a=0,n=0]=e.split(".").map(Number),[s=0,i=0,o=0]=t.split(".").map(Number);return s-r||i-a||o-n}("5.1.0",r.default.Prisma.prismaVersion.client)>=0,r.default.Prisma.defineExtension(e=>{let i,o,l,{apiKeyPromise:u,baseURL:c}=function(e){let t=Reflect.get(e,"_accelerateEngineConfig");try{let{host:e,hostname:r,protocol:a,searchParams:n}=new URL(t?.accelerateUtils?.resolveDatasourceUrl?.(t));if("prisma+postgres:"===a&&("localhost"===r||"127.0.0.1"===r))return{apiKeyPromise:Promise.resolve(n.get("api_key")),baseURL:new URL(`http://${e}`)}}catch{}return{apiKeyPromise:e._engine.start().then(()=>e._engine.apiKey?.()??null),baseURL:new URL("https://accelerate.prisma-data.net")}}(e),d=(i=r.default.Prisma.prismaVersion,o=["u">typeof navigator?navigator.userAgent:"u">typeof process&&"u">typeof process.versions?`Node/${process.versions.node} (${process.platform}; ${process.arch})`:"EdgeRuntime"in globalThis?"Vercel-Edge-Runtime":"UnknownRuntime",`PrismaEngine/${i.engine}`,`PrismaClient/${i.client}`].join(" "),async e=>{let{args:r}=e,{cacheStrategy:a,__accelerateInfo:s=!1,...i}=r,u=null,{__internalParams:c,query:d}=e;return c.customDataProxyFetch=()=>async(e,r)=>{let s=[];"number"==typeof a?.ttl&&s.push(`max-age=${a.ttl}`),"number"==typeof a?.swr&&s.push(`stale-while-revalidate=${a.swr}`);let i=a?.tags?.join(",")??"";r.headers={...r.headers,"cache-control":s.length>0?s.join(","):"no-cache","user-agent":o,...i.length>0?{"accelerate-cache-tags":i}:{}},l&&(r.headers["accelerate-query-engine-jwt"]=l);try{let a=await t(e,r);return u={cacheStatus:a.headers.get("accelerate-cache-status"),lastModified:new Date(a.headers.get("last-modified")??""),region:a.headers.get("cf-ray")?.split("-")[1]??"unspecified",requestId:a.headers.get("cf-ray")??"unspecified",signature:a.headers.get("accelerate-signature")??"unspecified"},l=a.headers.get("accelerate-query-engine-jwt")??void 0,a}catch{throw Error(n)}},s?{data:await d(i,c),info:u}:d(i,c)});async function p(e){let r,a=await u;if(!a)return{requestId:"unspecified"};try{r=await t(new URL("/invalidate",c).href,{method:"POST",headers:{authorization:`Bearer ${a}`,"content-type":"application/json"},body:JSON.stringify(e)})}catch{throw Error(n)}if(!r?.ok){let e=await r.text();throw Error(`Failed to invalidate Accelerate cache. Response was ${r.status} ${r.statusText}. ${e}`)}return r.body?.cancel(),{requestId:r.headers.get("cf-ray")??"unspecified"}}let h=e.$extends({name:a,query:{$allModels:{$allOperations:d}}});return h.$extends({name:a,client:{$accelerate:{invalidate:e=>p(e),invalidateAll:()=>p({tags:"all"})}},model:{$allModels:{aggregate(e){let t=r.default.Prisma.getExtensionContext(this),a=s?t.$parent[t.$name]:h[t.name];return Object.assign(a.aggregate(e),{withAccelerateInfo:()=>a.aggregate({...e,__accelerateInfo:!0})})},count(e){let t=r.default.Prisma.getExtensionContext(this),a=s?t.$parent[t.$name]:h[t.name];return Object.assign(a.count(e),{withAccelerateInfo:()=>a.count({...e,__accelerateInfo:!0})})},findFirst(e){let t=r.default.Prisma.getExtensionContext(this),a=s?t.$parent[t.$name]:h[t.name];return Object.assign(a.findFirst(e),{withAccelerateInfo:()=>a.findFirst({...e,__accelerateInfo:!0})})},findFirstOrThrow(e){let t=r.default.Prisma.getExtensionContext(this),a=s?t.$parent[t.$name]:h[t.name];return Object.assign(a.findFirstOrThrow(e),{withAccelerateInfo:()=>a.findFirstOrThrow({...e,__accelerateInfo:!0})})},findMany(e){let t=r.default.Prisma.getExtensionContext(this),a=s?t.$parent[t.$name]:h[t.name];return Object.assign(a.findMany(e),{withAccelerateInfo:()=>a.findMany({...e,__accelerateInfo:!0})})},findUnique(e){let t=r.default.Prisma.getExtensionContext(this),a=s?t.$parent[t.$name]:h[t.name];return Object.assign(a.findUnique(e),{withAccelerateInfo:()=>a.findUnique({...e,__accelerateInfo:!0})})},findUniqueOrThrow(e){let t=r.default.Prisma.getExtensionContext(this),a=s?t.$parent[t.$name]:h[t.name];return Object.assign(a.findUniqueOrThrow(e),{withAccelerateInfo:()=>a.findUniqueOrThrow({...e,__accelerateInfo:!0})})},groupBy(e){let t=r.default.Prisma.getExtensionContext(this),a=s?t.$parent[t.$name]:h[t.name];return Object.assign(a.groupBy(e),{withAccelerateInfo:()=>a.groupBy({...e,__accelerateInfo:!0})})}}}})})}())},501424,e=>{"use strict";e.s(["auth",()=>i,"createRoute",()=>a,"errorBoundary",()=>n,"jsonBody",()=>s,"requireRole",()=>o]);var t=e.i(282623),r=e.i(686929);let a=(e,t)=>{let r=e.reduceRight((e,t)=>t(e),t);return async(e,t)=>{let a=t?.params,n=a&&"function"==typeof a.then?await a:a,s=Object.fromEntries(new URL(e.url).searchParams.entries());return r({request:e,params:n,queryParams:s})}},n=()=>e=>async r=>{try{return await e(r)}catch(e){return(0,t.handleError)(e)}};function s(){return e=>async r=>{try{let t=await r.request.json();return e({...r,body:t})}catch{return(0,t.handleError)({status:400,message:"Invalid JSON body"})}}}let i=()=>r=>async a=>{let n=a.request.headers.get("cookie")||"",{parse:s}=await e.A(696569),i=await e.A(119764),o=s(n).jwt;if(!o)return(0,t.handleError)({status:401,message:"Не авторизован"});try{let e=i.default.verify(o,process.env.JWT_SECRET);return r({...a,userUuid:e})}catch{return(0,t.handleError)({status:401,message:"Неверный токен"})}},o=e=>a=>async n=>{let s=Array.isArray(e)?e:[e],i=await r.prisma.user.findFirst({where:{uuid:n.userUuid}});return i?s.includes(i.role)?a(n):(0,t.handleError)({status:403,message:"Нет доступа"}):(0,t.handleError)({status:401,message:"Не авторизован"})}},828522,e=>{"use strict";e.s(["addEditorToLocation",()=>c,"createLocation",()=>n,"deleteLocation",()=>l,"getLocations",()=>s,"updateLocation",()=>o]);var t=e.i(861166),r=e.i(686929);let a=t.default.object({title:t.default.string().min(1,"Название обязательно"),image:t.default.string().optional()}),n=async e=>(a.parse(e),r.prisma.location.create({data:e})),s=async e=>({data:await r.prisma.location.findMany((e=>({where:{title:{contains:e.search}},take:e.limit||10,skip:e.offset||0,orderBy:{createdAt:"asc"}}))(e)),limit:e.limit||10,offset:e.offset||0,total:await r.prisma.location.count({where:{title:{contains:e.search}}})}),i=a.partial(),o=async(e,t)=>(i.parse(t),r.prisma.location.update({where:{uuid:e},data:t})),l=async e=>r.prisma.location.delete({where:{uuid:e}}),u=t.default.object({editorUuid:t.default.string().min(1,"Uuid редактора обязательно")}),c=async(e,t)=>(u.parse(t),r.prisma.location.update({where:{uuid:e},data:{editors:{connect:{uuid:t.editorUuid}}}}))},694236,e=>{"use strict";e.s(["checkEditorAllowedToLocation",()=>n]);var t=e.i(686929),r=e.i(383097);let a=e.i(29173).$Enums.UserRole,n=async(e,n)=>{let s=await t.prisma.user.findFirst({where:{uuid:e}});if(!s)throw new r.ApiError({status:401,message:"Не авторизован"});if(s.role===a.EDITOR&&!await t.prisma.location.findFirst({where:{uuid:n,editors:{some:{uuid:e}}}}))throw new r.ApiError({status:403,message:"Нет доступа к этой локации"})}},55289,(e,t,r)=>{},565400,e=>{"use strict";e.s(["handler",()=>U,"patchFetch",()=>$,"routeModule",()=>_,"serverHooks",()=>C,"workAsyncStorage",()=>j,"workUnitAsyncStorage",()=>P],565400);var t=e.i(747909),r=e.i(174017),a=e.i(996250),n=e.i(759756),s=e.i(561916),i=e.i(869741),o=e.i(316795),l=e.i(487718),u=e.i(995169),c=e.i(47587),d=e.i(666012),p=e.i(570101),h=e.i(626937),m=e.i(10372),f=e.i(193695);e.i(52474);var g=e.i(600220);e.s(["DELETE",()=>A,"PATCH",()=>E],562346);var x=e.i(501424),w=e.i(29173),y=e.i(63059),R=e.i(828522),v=e.i(694236);let E=(0,x.createRoute)([(0,x.errorBoundary)(),(0,x.auth)(),(0,x.requireRole)([w.UserRole.ADMIN,w.UserRole.EDITOR]),(0,x.jsonBody)()],async({body:e,params:t,userUuid:r})=>{await (0,v.checkEditorAllowedToLocation)(r||"",t?.uuid||"");let a=await (0,R.updateLocation)(t?.uuid||"",e);return(0,y.handleResponse)("Локация успешно обновлена",200,a)}),A=(0,x.createRoute)([(0,x.errorBoundary)(),(0,x.auth)(),(0,x.requireRole)(w.UserRole.ADMIN)],async({params:e})=>{let t=await (0,R.deleteLocation)(e?.uuid||"");return(0,y.handleResponse)("Локация успешно удалена",200,t)});var b=e.i(562346);let _=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/locations/[uuid]/route",pathname:"/api/locations/[uuid]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/locations/[uuid]/route.ts",nextConfigOutput:"",userland:b}),{workAsyncStorage:j,workUnitAsyncStorage:P,serverHooks:C}=_;function $(){return(0,a.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:P})}async function U(e,t,a){var x;let w="/api/locations/[uuid]/route";w=w.replace(/\/index$/,"")||"/";let y=await _.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:R,params:v,nextConfig:E,isDraftMode:A,prerenderManifest:b,routerServerContext:j,isOnDemandRevalidate:P,revalidateOnlyGenerated:C,resolvedPathname:$}=y,U=(0,i.normalizeAppPath)(w),q=!!(b.dynamicRoutes[U]||b.routes[$]);if(q&&!A){let e=!!b.routes[$],t=b.dynamicRoutes[U];if(t&&!1===t.fallback&&!e)throw new f.NoFallbackError}let O=null;!q||_.isDev||A||(O="/index"===(O=$)?"/":O);let T=!0===_.isDev||!q,I=q&&!T,k=e.method||"GET",N=(0,s.getTracer)(),S=N.getActiveScopeSpan(),L={params:v,prerenderManifest:b,renderOpts:{experimental:{cacheComponents:!!E.experimental.cacheComponents,authInterrupts:!!E.experimental.authInterrupts},supportsDynamicResponse:T,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:null==(x=E.experimental)?void 0:x.cacheLife,isRevalidate:I,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>_.onRequestError(e,t,a,j)},sharedContext:{buildId:R}},M=new o.NodeNextRequest(e),D=new o.NodeNextResponse(t),F=l.NextRequestAdapter.fromNodeNextRequest(M,(0,l.signalFromNodeResponse)(t));try{let i=async r=>_.handle(F,L).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=N.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let e=`${k} ${n}`;r.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),r.updateName(e)}else r.updateName(`${k} ${e.url}`)}),o=async s=>{var o,l;let u=async({previousCacheEntry:r})=>{try{if(!(0,n.getRequestMeta)(e,"minimalMode")&&P&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(s);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=L.renderOpts.collectedTags;if(!q)return await (0,d.sendResponse)(M,D,o,L.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[m.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:I,isOnDemandRevalidate:P})},j),t}},f=await _.handleResponse({req:e,nextConfig:E,cacheKey:O,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:C,responseGenerator:u,waitUntil:a.waitUntil});if(!q)return null;if((null==f||null==(o=f.value)?void 0:o.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==f||null==(l=f.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,n.getRequestMeta)(e,"minimalMode")||t.setHeader("x-nextjs-cache",P?"REVALIDATED":f.isMiss?"MISS":f.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let x=(0,p.fromNodeOutgoingHttpHeaders)(f.value.headers);return(0,n.getRequestMeta)(e,"minimalMode")&&q||x.delete(m.NEXT_CACHE_TAGS_HEADER),!f.cacheControl||t.getHeader("Cache-Control")||x.get("Cache-Control")||x.set("Cache-Control",(0,h.getCacheControlHeader)(f.cacheControl)),await (0,d.sendResponse)(M,D,new Response(f.value.body,{headers:x,status:f.value.status||200})),null};S?await o(S):await N.withPropagatedContext(e.headers,()=>N.trace(u.BaseServerSpan.handleRequest,{spanName:`${k} ${e.url}`,kind:s.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},o))}catch(t){if(S||t instanceof f.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isRevalidate:I,isOnDemandRevalidate:P})}),q)throw t;return await (0,d.sendResponse)(M,D,new Response(null,{status:500})),null}}},696569,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_cookie_dist_index_fbb96389.js"].map(t=>e.l(t))).then(()=>t(904739)))},119764,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__005937e3._.js","server/chunks/node_modules_5cb7c69b._.js"].map(t=>e.l(t))).then(()=>t(724652)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__9d4e4330._.js.map